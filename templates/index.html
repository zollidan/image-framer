<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InstaRetro - –£–ª—É—á—à–µ–Ω–Ω—ã–π UI</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f0f2f5;
        display: grid;
        place-items: center;
        height: 100vh;
        margin: 0;
        padding: 20px;
      }
      .container {
        background-color: #fff;
        padding: 30px 40px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        text-align: center;
        max-width: 500px;
        width: 100%;
        transition: all 0.3s ease;
      }
      h1 {
        color: #1c1e21;
        font-size: 2rem;
      }
      p {
        color: #606770;
        margin-bottom: 30px;
      }
      form {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }
      input[type="file"] {
        display: none;
      }
      .file-label {
        background-color: #1877f2;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-block;
        font-weight: bold;
        transition: background-color 0.2s;
      }
      .file-label:hover {
        background-color: #166fe5;
      }
      #file-name {
        color: #606770;
        font-style: italic;
      }
      button {
        background-color: #42b72a;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        width: 100%;
        transition: background-color 0.2s;
      }
      button:hover {
        background-color: #36a420;
      }
      button:disabled {
        background-color: #a0a0a0;
        cursor: not-allowed;
      }
      /* –°–ø–∏–Ω–Ω–µ—Ä */
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
        display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .result {
        margin-top: 30px;
      }
      .result img {
        max-width: 100%;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
      .result a {
        display: inline-block;
        margin-top: 15px;
        color: #fff;
        background-color: #1877f2;
        padding: 10px 15px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
      }
      .error {
        color: #fa383e;
        background-color: #ffebee;
        padding: 10px;
        border-radius: 6px;
        margin-top: 20px;
        border: 1px solid #fa383e;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>InstaRetro üéûÔ∏è</h1>
      <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª—å–Ω—É—é —Ä–µ—Ç—Ä–æ-—Ä–∞–º–∫—É.</p>

      <div id="error-container"></div>

      <form id="upload-form">
        <label for="file" class="file-label">–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ...</label>
        <input type="file" name="file" id="file" required accept="image/*" />
        <span id="file-name">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
        <button type="submit" id="submit-button">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
      </form>

      <div class="loader" id="loader"></div>
      <div class="result" id="result-container"></div>
    </div>

    <script>
      const form = document.getElementById("upload-form");
      const inputFile = document.getElementById("file");
      const fileNameSpan = document.getElementById("file-name");
      const submitButton = document.getElementById("submit-button");
      const loader = document.getElementById("loader");
      const resultContainer = document.getElementById("result-container");
      const errorContainer = document.getElementById("error-container");

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
      inputFile.addEventListener("change", () => {
        if (inputFile.files.length > 0) {
          fileNameSpan.textContent = inputFile.files[0].name;
        } else {
          fileNameSpan.textContent = "–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω";
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã

        if (inputFile.files.length === 0) {
          displayError("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.");
          return;
        }

        const formData = new FormData();
        formData.append("file", inputFile.files[0]);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        loader.style.display = "block";
        submitButton.disabled = true;
        submitButton.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞...";
        resultContainer.innerHTML = "";
        errorContainer.innerHTML = "";

        try {
          const response = await fetch("/process-json/", {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –Ω–æ–≤—ã–π JSON-—ç–Ω–¥–ø–æ–∏–Ω—Ç
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (!response.ok) {
            // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É
            throw new Error(data.detail || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
          }

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          resultContainer.innerHTML = `
                    <h2>–ì–æ—Ç–æ–≤–æ!</h2>
                    <img src="${data.url}" alt="–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                    <a href="${data.url}" download>–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a>
                `;
        } catch (error) {
          displayError(error.message);
        } finally {
          // –ü—Ä—è—á–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
          loader.style.display = "none";
          submitButton.disabled = false;
          submitButton.textContent = "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å";
        }
      });

      function displayError(message) {
        errorContainer.innerHTML = `<div class="error">${message}</div>`;
      }
    </script>
  </body>
</html>
